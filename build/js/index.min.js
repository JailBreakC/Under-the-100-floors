var gameController={_animation:null,_canvasWidth:0,_canvasHeight:0,_floorWidth:0,_floorHeight:0,_floorDeltaY:50,_floorScore:1,_speed:50,_maxSpeed:350,_blood:12,_$canvas:$(".game-canvas"),_$scroller:$(".scroller"),_$people:$(".people"),_peopleSpeed:180,_peopleRotateZ:0,_peopleRotateDelta:25,_peopleVerticalSpeed:200,_peopleHeight:0,_peopleWidth:0,__currentScrollerY:0,__currentPeopleY:20,__currentPeopleVertical:0,__floorScrollerY:200,__maxJumpDistance:20,__currentJumpDistance:0,__frameIndex:0,gameover:function(){this.stop(),setTimeout(function(){$("#game-ct").hide(),$(".game-over").show()}.bind(this),200),_czc.push(["_trackEvent","score","game","gameover",this._floorScore])},createFloorSpan:function(){var t=this.__floorScrollerY+=this._floorDeltaY,e=Math.random()*(this._canvasWidth-this._floorWidth),o=['<i class="floor normal"></i>','<i class="floor normal"></i>','<i class="floor spring"></i>','<i class="floor spring"></i>','<i class="floor weak"></i>','<i class="floor weak"></i>','<i class="floor scroll-left"></i>','<i class="floor scroll-right"></i>','<i class="floor nail"></i>','<i class="floor nail"></i>','<i class="floor nail"></i>','<i class="floor nail"></i>'];$(o[Math.floor(Math.random()*o.length)]).css({top:t,left:e,width:this._floorWidth,height:this._floorHeight}).appendTo(this._$scroller)},removeFloorSpan:function(){$(".floor").eq(0).remove(),this._floorScore++,this.updateScore()},updateBlood:function(){for(var t=$(".blood i"),e=0;e<t.length;e++)e<this._blood?t.eq(e).removeClass("lose"):t.eq(e).addClass("lose")},updateScore:function(){$(".text-score").text(this._floorScore)},loseBlood:function(){if(!this.__onFloor)return this._blood-=4,this._$people.addClass("danger"),setTimeout(function(){this._$people.removeClass("danger")}.bind(this),1e3),$("#game-ct").addClass("danger"),setTimeout(function(){$("#game-ct").removeClass("danger")},100),this._blood<=0?(this._blood=0,this.updateBlood(),void this.gameover()):void this.updateBlood()},addBlood:function(){this.__onFloor||this._blood>=12||(this._blood+=1,this.updateBlood())},floorNormal:function(){this.addBlood()},floorNail:function(){this.loseBlood()},floorWeak:function(t){this.addBlood(),setTimeout(function(){t.addClass("over"),t[0].cross=!0},200)},floorScroll:function(t){this.addBlood(),this.__floorScrollDirection=t},floorScrollEnd:function(){this.__floorScrollDirection=null},floorSpring:function(t){this.__$currentJumpFloor=t,this.jumpStart(),this.addBlood()},jumpStart:function(){this.__jumpMode=!0,this.__$currentJumpFloor.addClass("up"),setTimeout(function(){this.__$currentJumpFloor.removeClass("up")}.bind(this),200),this.__tempPeopleSpeed=this._peopleSpeed,this._peopleSpeed=this._peopleSpeed/2},jumpEnd:function(t){this.__jumpMode&&(t&&(this.__$currentJumpFloor[0].cross=!0),this.__currentJumpDistance=0,this.__jumpMode=!1,this._peopleSpeed=this.__tempPeopleSpeed)},people:function(t){var e=this._peopleSpeed/t,o=this._speed/t,r=this._peopleVerticalSpeed/t,s=$(".floor"),l=this._$people.offset();if(l.top>this._canvasHeight)return void this.gameover();for(i=0;i<s.length;i++){var n=s.eq(i).offset(),a=Math.abs(l.top+this._peopleHeight-n.top);if(l.top<=e+o){this.__onFloor=!1,this.jumpEnd(!0),this.loseBlood();break}if(!this.__jumpMode&&!s.eq(i)[0].cross&&a<=e+o&&l.left>n.left-this._peopleWidth&&l.left<n.left+this._floorWidth){this.__currentPeopleY=n.top-this._peopleHeight,s.eq(i).hasClass("normal")&&this.floorNormal(),s.eq(i).hasClass("nail")&&this.floorNail(),s.eq(i).hasClass("spring")&&this.floorSpring(s.eq(i)),s.eq(i).hasClass("weak")&&this.floorWeak(s.eq(i)),s.eq(i).hasClass("scroll-left")&&this.floorScroll("left"),s.eq(i).hasClass("scroll-right")&&this.floorScroll("right"),this.__onFloor=!0;break}i==s.length-1&&(this.__onFloor=!1)}this.__jumpMode&&(this.__currentJumpDistance>=this.__maxJumpDistance?this.jumpEnd():(this.__currentJumpDistance+=e,this.__currentPeopleY-=e+o)),this.__onFloor||this.__jumpMode||(this.floorScrollEnd(),this.__currentPeopleY+=e);var h=r;this._peopleGoLeft&&("left"==this.__floorScrollDirection&&(h*=1.5),"right"==this.__floorScrollDirection&&(h*=.5),this.__currentPeopleVertical>0&&(this.__currentPeopleVertical-=h)),this._peopleGoRight&&("left"==this.__floorScrollDirection&&(h*=.5),"right"==this.__floorScrollDirection&&(h*=1.5),this.__currentPeopleVertical<this._canvasWidth-this._peopleWidth&&(this.__currentPeopleVertical+=h)),this._peopleGoRight||this._peopleGoLeft||(h*=.5,"left"==this.__floorScrollDirection&&this.__currentPeopleVertical>0&&(this.__currentPeopleVertical-=h),"right"==this.__floorScrollDirection&&this.__currentPeopleVertical<this._canvasWidth-this._peopleWidth&&(this.__currentPeopleVertical+=h)),this.peopleUpdateView()},floorUpdateView:function(){Modernizr.csstransforms3d?this._$scroller.css({"-webkit-transform":"translate3d(0, "+this.__currentScrollerY+"px, 0)","-ms-transform":"translate3d(0, "+this.__currentScrollerY+"px, 0)",transform:"translate3d(0, "+this.__currentScrollerY+"px, 0)"}):Modernizr.csstransforms?this._$scroller.css({"-webkit-transform":"translateY("+this.__currentScrollerY+"px)","-ms-transform":"translateY("+this.__currentScrollerY+"px)",transform:"translateY("+this.__currentScrollerY+"px)"}):this._$scroller.css({top:this.__currentScrollerY+"px"})},peopleUpdateView:function(){this.__onFloor&&(this._peopleGoLeft&&(this._peopleRotateZ-=this._peopleRotateDelta),this._peopleGoRight&&(this._peopleRotateZ+=this._peopleRotateDelta)),Modernizr.csstransforms3d?this._$people.css({"-webkit-transform":"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)","-ms-transform":"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)",transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"}):Modernizr.csstransforms?this._$people.css({"-webkit-transform":"translate("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px)","-ms-transform":"translate("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px)",transform:"translate("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px)"}):this._$people.css({left:this.__currentPeopleVertical+"px",top:this.__currentPeopleY+"px"})},peopleUserController:function(){var t=this;$(window).keydown(function(e){return"ArrowRight"==e.key?(t._peopleGoRight=!0,void(t._peopleGoLeft=!1)):"ArrowLeft"==e.key?(t._peopleGoRight=!1,void(t._peopleGoLeft=!0)):void 0}).keyup(function(e){return"ArrowRight"==e.key?void(t._peopleGoRight=!1):"ArrowLeft"==e.key?void(t._peopleGoLeft=!1):void 0}),$(".controller .left-ct").on("touchstart",function(e){return t._peopleGoRight=!1,t._peopleGoLeft=!0,!1}).on("touchend",function(e){t._peopleGoLeft=!1}),$(".controller .right-ct").on("touchstart",function(e){return t._peopleGoRight=!0,t._peopleGoLeft=!1,!1}).on("touchend",function(e){t._peopleGoRight=!1})},core:function(t){var e=this._speed/t,o=$(".floor");if(this.__currentScrollerY-=e,this.__currentScrollerY<=2*-this._canvasHeight)for(this.__currentScrollerY+=this._canvasHeight,this.__floorScrollerY-=this._canvasHeight,i=0;i<o.length;i++)o.eq(i).css({top:parseInt($(".floor").eq(i).css("top"))-this._canvasHeight});this.floorUpdateView(),o.eq(0).offset().top<=-20&&(this.createFloorSpan(),this.removeFloorSpan()),this.people(t),this._speed<=this._maxSpeed&&(this._speed+=.05)},run:function(t){if(this._animation)return void console.error("Animation has aready in process, please do not run again!");this._fps=t=t||60;var e=1e3/t,o=this;return this._animation=setInterval(function(){o.core(t)},e)},stop:function(){clearInterval(this._animation),this._animation=void 0},reRun:function(){console.log(this.__paramBackup._floorScore),$.extend(this,this.__paramBackup),$(".floor").remove(),this.init()},backup:function(){this.__paramBackup={};for(i in this)"number"!=typeof this[i]&&"string"!=typeof this[i]||(this.__paramBackup[i]=this[i])},init:function(){var t=0;for(this._canvasWidth=this._$canvas.width(),this._canvasHeight=this._$canvas.height(),this._floorDeltaY=this._canvasHeight/11,this._floorWidth=this._canvasWidth/5,this._floorHeight=this._floorWidth/9,this._peopleHeight=parseInt(this._$people.css("height")),this._peopleWidth=parseInt(this._$people.css("width")),this.__currentPeopleVertical=this._canvasWidth/2+this._peopleWidth/2,this.backup();t++<13;)this.createFloorSpan();this.peopleUserController(),this.peopleUpdateView(),this.updateBlood(),this.updateScore(),this.run(60)}};$(function(){$("body").on("touchstart",function(t){return!1}),$("#start-game").on("touchstart",function(){$(".game-intro").hide(),$("#game-ct").show(),gameController.init()}),$("#restart-game").on("touchstart",function(){$("#game-ct").show(),$(".game-over").hide(),gameController.reRun()});var t=function(){for(var t=["../../public/images/spring-up.png"],e=0;e<t.length;e++){var o=new Image;o.src=t[e]}};t()});