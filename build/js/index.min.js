var gameController={_animation:null,_canvasWidth:0,_canvasHeight:0,_floorWidth:$(".canvas").width()/6,_floorDeltaY:50,_floorScore:1,_speed:50,_blood:12,_$canvas:$(".canvas"),_$scroller:$(".scroller"),_$people:$(".people"),_peopleSpeed:180,_peopleVerticalSpeed:150,_peopleHeight:$(".people").height(),_peopleWidth:$(".people").width(),_scrollerHeight:$(".scroller").height(),__currentScrollerY:0,__currentPeopleY:1,__currentPeopleVertical:0,__floorScrollerY:200,__frameIndex:0,gameover:function(){this.stop(),alert("Game Over"),window.location.reload()},createFloorSpan:function(){var o=this.__floorScrollerY+=this._floorDeltaY,e=Math.random()*(this._canvasWidth-this._floorWidth),t=['<i class="floor normal"></i>','<i class="floor weak"></i>','<i class="floor scroll-left"></i>','<i class="floor scroll-right"></i>','<i class="floor nail"></i>'];$(t[Math.floor(5*Math.random())]).css({top:o,left:e,width:this._floorWidth}).appendTo(this._$scroller)},removeFloorSpan:function(){$(".floor").eq(0).remove(),this._floorScore++,$(".floor-count").text(this._floorScore)},loseBlood:function(){if(!this.__onFloor)return this._blood-=4,this._blood<=0?($(".blood").text(0),void this.gameover()):void $(".blood").text(this._blood)},addBlood:function(){this.__onFloor||this._blood>=12||(this._blood+=1,$(".blood").text(this._blood))},floorNormal:function(){this.addBlood()},floorNail:function(){this.loseBlood()},floorWeak:function(o){var e=this;this.addBlood(),o.addClass("over"),setTimeout(function(){e._forceCross=!0},200),setTimeout(function(){e._forceCross=!1},250)},floorScroll:function(o){this.addBlood()},people:function(o){var e=this._peopleSpeed/o,t=this._peopleVerticalSpeed/o,r=$(".floor"),l=this._$people.offset();if(l.top>this._canvasHeight)return void this.gameover();for(i=0;i<r.length;i++){var s=r.eq(i).offset(),n=Math.abs(l.top+this._peopleHeight-s.top);if(l.top<=0){this.loseBlood(),this.__onFloor=!1;break}if(!this._forceCross&&n<=5&&l.left>s.left-this._peopleWidth&&l.left<s.left+this._floorWidth){this.__currentPeopleY=s.top-this._peopleHeight+2,this._$people.css({transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"}),_deltaY=this._speed/o,this.__currentPeopleY-=_deltaY,r.eq(i).hasClass("normal")&&this.floorNormal(),r.eq(i).hasClass("nail")&&this.floorNail(),r.eq(i).hasClass("weak")&&this.floorWeak(r.eq(i)),r.eq(i).hasClass("scroll-left")&&this.floorScroll("left"),r.eq(i).hasClass("scroll-right")&&this.floorScroll("right"),this.__onFloor=!0;break}i==r.length-1&&(this.__onFloor=!1)}this.__onFloor||(this.__currentPeopleY+=e),this._peopleGoLeft&&this.__currentPeopleVertical>0&&(this.__currentPeopleVertical-=t),this._peopleGoRight&&this.__currentPeopleVertical<this._canvasWidth-this._peopleWidth&&(this.__currentPeopleVertical+=t),this._$people.css({transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"})},peopleUserController:function(){var o=this;$(window).keydown(function(e){return"ArrowRight"==e.key?(o._peopleGoRight=!0,void(o._peopleGoLeft=!1)):"ArrowLeft"==e.key?(o._peopleGoRight=!1,void(o._peopleGoLeft=!0)):void 0}).keyup(function(e){return"ArrowRight"==e.key?void(o._peopleGoRight=!1):"ArrowLeft"==e.key?void(o._peopleGoLeft=!1):void 0}),$(".controller .left-ct").on("touchstart",function(e){return o._peopleGoRight=!1,o._peopleGoLeft=!0,!1}).on("touchend",function(e){o._peopleGoLeft=!1}),$(".controller .right-ct").on("touchstart",function(e){return o._peopleGoRight=!0,o._peopleGoLeft=!1,!1}).on("touchend",function(e){o._peopleGoRight=!1})},core:function(o){var e=this,t=this._speed/o;if(this.__currentScrollerY-=t,this.__currentScrollerY<=2*-this._canvasHeight){this.__currentScrollerY+=this._canvasHeight,this.__floorScrollerY-=this._canvasHeight;var r=$(".floor");for(i=0;i<r.length;i++)r.eq(i).css({top:parseInt($(".floor").eq(i).css("top"))-this._canvasHeight})}this._$scroller.css({transform:"translate3d(0, "+e.__currentScrollerY+"px, 0)"}),$(".floor").eq(0).offset().top<=-20&&(this.createFloorSpan(),this.removeFloorSpan()),this.people(o),this._speed<=200&&(this._speed+=.05)},run:function(o){if(this._animation)return void console.error("Animation has aready in process, please do not run again!");o=o||60;var e=1e3/o,t=this;return this._animation=setInterval(function(){t.core(o)},e)},stop:function(){clearInterval(this._animation)},init:function(){var o=this,e=0;for($(window).resize(function(){o._canvasWidth=o._$canvas.width(),o._canvasHeight=o._$canvas.height()}),o._canvasWidth=$(".canvas").width(),o._canvasHeight=o._$canvas.height();e++<13;)this.createFloorSpan();this.peopleUserController(),this.__currentPeopleVertical=this._canvasWidth/2+this._peopleWidth/2,this._$people.show(),this._$people.css({transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"}),this.run(60)}};$(function(){gameController.init()});