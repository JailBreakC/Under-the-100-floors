var gameController={_animation:null,_canvasWidth:0,_canvasHeight:0,_currentFloor:0,_floorWidth:90,_floorDeltaY:50,_speed:50,_$canvas:$(".canvas"),_$scroller:$(".scroller"),_$people:$(".people"),_peopleSpeed:180,_peopleVerticalSpeed:150,_peopleHeight:$(".people").height(),_peopleWidth:$(".people").width(),_scrollerHeight:$(".scroller").height(),__currentScrollerY:0,__currentPeopleY:0,__currentPeopleVertical:0,__frameIndex:0,createFloorSpan:function(){this._currentFloor++;var e=this._currentFloor*this._floorDeltaY+200,t=Math.random()*(this._canvasWidth-this._floorWidth);$('<i class="floor"></i>').css({top:e,left:t}).appendTo(this._$scroller)},removeFloorSpan:function(){$(".floor").eq(0).remove()},people:function(e){var t=this._peopleSpeed/e,o=this._peopleVerticalSpeed/e,r=$(".floor"),l=this._$people.offset();if(l.top>this._canvasHeight)return alert("Game over!"),this.stop(),void window.location.reload();for(i=0;i<r.length;i++){var n=r.eq(i).offset(),s=Math.abs(l.top+this._peopleHeight-n.top);if(l.top<=0){this.__onFloor=!1;break}if(s<=5&&l.left>n.left-this._peopleWidth&&l.left<n.left+this._floorWidth){this.__currentPeopleY=n.top-this._peopleHeight+2,this._$people.css({transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"}),this.__onFloor=!0,_deltaY=this._speed/e,this.__currentPeopleY-=_deltaY;break}this.__onFloor=!1}this.__onFloor||(this.__currentPeopleY+=t),this._peopleGoLeft&&this.__currentPeopleVertical>0&&(this.__currentPeopleVertical-=o),this._peopleGoRight&&this.__currentPeopleVertical<this._canvasWidth-this._peopleWidth&&(this.__currentPeopleVertical+=o),this._$people.css({transform:"translate3d("+this.__currentPeopleVertical+"px , "+this.__currentPeopleY+"px ,0)"})},peopleUserController:function(){var e=this;$(window).keydown(function(t){return console.log(t.key),"ArrowRight"==t.key?(e._peopleGoRight=!0,void(e._peopleGoLeft=!1)):"ArrowLeft"==t.key?(e._peopleGoRight=!1,void(e._peopleGoLeft=!0)):void 0}),$(window).keyup(function(t){return"ArrowRight"==t.key?void(e._peopleGoRight=!1):"ArrowLeft"==t.key?void(e._peopleGoLeft=!1):void 0})},core:function(e){var t=this,o=this._speed/e;this.__currentScrollerY-=o,this._$scroller.css({transform:"translate3d(0, "+t.__currentScrollerY+"px, 0)"}),$(".floor").eq(0).offset().top<=-20&&(this.createFloorSpan(),this.removeFloorSpan()),this.people(e),this._speed<=200&&(this._speed+=.1)},run:function(e){if(this._animation)return void console.error("Animation has aready in process, please do not run again!");e=e||60;var t=1e3/e,o=this;return this._animation=setInterval(function(){o.core(e)},t)},stop:function(){clearInterval(this._animation)},init:function(){var e=this,t=0;for($(window).resize(function(){e._canvasWidth=e._$canvas.width(),e._canvasHeight=e._$canvas.height()}),e._canvasWidth=$(".canvas").width(),e._canvasHeight=e._$canvas.height();t++<13;)this.createFloorSpan();this.peopleUserController(),this.run(60)}};$(function(){gameController.init()});